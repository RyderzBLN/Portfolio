import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { IntersectionStatus } from './observables/from-intersection-observer';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "./directives/intersection-observer.directive";
export var MarqueeState;
(function (MarqueeState) {
    MarqueeState["Running"] = "running";
    MarqueeState["Paused"] = "paused";
    MarqueeState["Stopped"] = "stopped";
})(MarqueeState || (MarqueeState = {}));
export var MarqueeDirection;
(function (MarqueeDirection) {
    MarqueeDirection["Left"] = "left";
    MarqueeDirection["Right"] = "right";
    MarqueeDirection["Alternate"] = "alternate";
})(MarqueeDirection || (MarqueeDirection = {}));
export var MarqueeAnimation;
(function (MarqueeAnimation) {
    MarqueeAnimation["Default"] = "default";
    MarqueeAnimation["SlideInUp"] = "slideInUp";
    MarqueeAnimation["SlideInDown"] = "slideInDown";
})(MarqueeAnimation || (MarqueeAnimation = {}));
export class NgxMarqueeComponent {
    constructor(_renderer) {
        this._renderer = _renderer;
        this._outerFlags = [false, false];
        this.debounce = 0;
        this.root = undefined;
        this.rootMargin = '0px';
        this.threshold = 0;
        this.duration = '20s';
        this.animation = MarqueeAnimation.Default;
        this.pauseOnHover = false;
        this.pendingUpdates = false;
        this.pendingUpdatesChange = new EventEmitter();
        this.playStateChange = new EventEmitter();
        if (typeof this.taskOnUpdateContent !== 'function') {
            this.taskOnUpdateContent = () => { };
        }
        if (typeof this.taskOnUpdateDuration !== 'function') {
            this.taskOnUpdateDuration = () => {
                return this.duration;
            };
        }
    }
    ngAfterViewInit() {
        this._elementMarquee = this._renderer.selectRootElement(this.tape, true).nativeElement;
        this._resetMarquee();
    }
    playPause() {
        if (this._dataPlayState === null || this._dataPlayState === MarqueeState.Running) {
            this._pauseElement();
        }
        else {
            this._playElement();
        }
    }
    stop() {
        this._resetAnimation();
        this._stopElement();
    }
    restart() {
        this._resetAnimation();
        this._playElement();
    }
    onVisibilityChanged(status, control) {
        if (status !== IntersectionStatus.Pending) {
            if (status === IntersectionStatus.Visible) {
                this._outerFlags[control] = true;
            }
            else if (status === IntersectionStatus.NotVisible) {
                this._outerFlags[control] = false;
            }
            if (this.pendingUpdates) {
                if ((this.direction === undefined || this.direction === MarqueeDirection.Left) && (this._outerFlags[0] === true && this._outerFlags[1] === false)) {
                    this._execProcedure();
                }
                else if (this.direction === MarqueeDirection.Right && (this._outerFlags[0] === false && this._outerFlags[1] === true)) {
                    this._execProcedure();
                }
            }
        }
    }
    _execProcedure() {
        this.taskOnUpdateContent();
        this._resetMarquee();
        this._setPendingUpdates(false);
    }
    _setDataPlayState(state) {
        this._dataPlayState = state;
        this.playStateChange.emit(this._dataPlayState);
    }
    _setPendingUpdates(state) {
        this.pendingUpdates = state;
        this.pendingUpdatesChange.emit(this.pendingUpdates);
    }
    _resetMarquee() {
        this.stop();
        this._calculateDuration();
        this._playElement();
    }
    _calculateDuration() {
        this.duration = this.taskOnUpdateDuration();
    }
    _playElement() {
        this._setAnimationState('running', true);
        this._setDataAttrState('running');
        this._setDataPlayState(MarqueeState.Running);
    }
    _pauseElement() {
        this._setAnimationState('paused');
        this._setDataAttrState('paused');
        this._setDataPlayState(MarqueeState.Paused);
    }
    _stopElement() {
        this._setAnimationState('paused');
        this._setDataAttrState('stopped');
        this._setDataPlayState(MarqueeState.Stopped);
        this._setPendingUpdates(false);
    }
    _setAnimationState(state = '', fix = false) {
        this._renderer.setStyle(this._elementMarquee, 'animation-play-state', state);
        if (fix) {
            this._fixAnimationState();
        }
    }
    _resetAnimation() {
        this._renderer.setStyle(this._elementMarquee, 'animation', 'none');
        let fix = this._elementMarquee.offsetWidth;
        fix = fix;
        this._renderer.setStyle(this._elementMarquee, 'animation', `${this.duration} linear infinite`);
        this._renderer.setStyle(this._elementMarquee, '-webkit-animation', `${this.duration} linear infinite`);
        switch (this.direction) {
            case 'alternate':
                this._renderer.setStyle(this._elementMarquee, 'animation-direction', 'alternate');
                break;
            default:
                this._renderer.setStyle(this._elementMarquee, 'animation-direction', 'normal');
                break;
        }
        if (this.direction !== MarqueeDirection.Alternate) {
            if (this.direction === undefined || this.direction === MarqueeDirection.Left) {
                if (this.animation === MarqueeAnimation.SlideInUp) {
                    this._renderer.setStyle(this._elementMarquee, 'animation-name', 'slide-in-up');
                }
                else if (this.animation === MarqueeAnimation.SlideInDown) {
                    this._renderer.setStyle(this._elementMarquee, 'animation-name', 'slide-in-down');
                }
                else {
                    this._renderer.setStyle(this._elementMarquee, 'animation-name', 'movement-smooth');
                }
            }
            else if (this.direction === MarqueeDirection.Right) {
                if (this.animation === MarqueeAnimation.SlideInUp) {
                    this._renderer.setStyle(this._elementMarquee, 'animation-name', 'slide-in-up-right');
                }
                else if (this.animation === MarqueeAnimation.SlideInDown) {
                    this._renderer.setStyle(this._elementMarquee, 'animation-name', 'slide-in-down-right');
                }
                else {
                    this._renderer.setStyle(this._elementMarquee, 'animation-direction', 'reverse');
                    this._renderer.setStyle(this._elementMarquee, 'animation-name', 'movement-smooth');
                }
            }
        }
        else {
            this._renderer.setStyle(this._elementMarquee, 'animation-name', 'movement-smooth');
        }
    }
    _setDataAttrState(state = '') {
        this._renderer.setAttribute(this._elementMarquee, 'data-play-state', state);
    }
    _fixAnimationState() {
        this._renderer.removeStyle(this._elementMarquee, 'animation-play-state');
    }
}
NgxMarqueeComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.2.0", ngImport: i0, type: NgxMarqueeComponent, deps: [{ token: i0.Renderer2 }], target: i0.ɵɵFactoryTarget.Component });
NgxMarqueeComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.2.0", type: NgxMarqueeComponent, selector: "ngx-marquee", inputs: { direction: "direction", duration: "duration", pauseOnHover: "pauseOnHover", animation: "animation", taskOnUpdateContent: "taskOnUpdateContent", taskOnUpdateDuration: "taskOnUpdateDuration", pendingUpdates: "pendingUpdates" }, outputs: { pendingUpdatesChange: "pendingUpdatesChange", playStateChange: "playStateChange" }, viewQueries: [{ propertyName: "tape", first: true, predicate: ["tape"], descendants: true }], ngImport: i0, template: "<div class=\"ngx-marquee\" [ngClass]=\"{'ngx-marquee-pause-on-hover': pauseOnHover}\">\r\n    <span #tape>\r\n        <span class=\"ticker-control ticker-start\" \r\n            intersectionObserver\r\n            [intersectionRoot]=\"root\"\r\n            [intersectionRootMargin]=\"rootMargin\"\r\n            [intersectionThreshold]=\"threshold\"\r\n            [intersectionDebounce]=\"debounce\"\r\n            (visibilityChange)=\"onVisibilityChanged($event, 0)\">L</span>\r\n        <span class=\"tickers\">\r\n            <ng-content></ng-content>\r\n        </span>\r\n        <span class=\"ticker-control ticker-end\"\r\n            intersectionObserver\r\n            [intersectionRoot]=\"root\"\r\n            [intersectionRootMargin]=\"rootMargin\"\r\n            [intersectionThreshold]=\"threshold\"\r\n            [intersectionDebounce]=\"debounce\"\r\n            (visibilityChange)=\"onVisibilityChanged($event, 1)\">R</span>\r\n    </span>\r\n</div>", styles: [".ngx-marquee{overflow:hidden;text-align:left}.ngx-marquee.ngx-marquee-pause-on-hover:hover>span{animation-play-state:paused}.ngx-marquee>span{content:attr(data-marquee);display:inline-block;position:relative;white-space:nowrap;animation:linear infinite}.ngx-marquee>span{animation-duration:20s}.ngx-marquee>span{animation-direction:normal}.ngx-marquee span.ticker-control{display:inline-block;width:20px;text-align:center;color:transparent;background-color:transparent}.ngx-marquee.ngx-marquee-direction-left>span,.ngx-marquee.ngx-marquee-direction-normal>span{animation-direction:normal}@keyframes movement-smooth{0%{transform:translate(0);left:100%}to{transform:translate(-100%);left:0%}}@keyframes slide-in-up{0%{transform:translateY(100%);left:0%}10%{transform:translateY(0);left:0%}16%{transform:translate(0)}to{transform:translate(-100%);left:0%}}@keyframes slide-in-down{0%{transform:translateY(-100%);left:0%}10%{transform:translateY(0);left:0%}16%{transform:translate(0)}to{transform:translate(-100%);left:0%}}@keyframes slide-in-up-right{0%{transform:translate(-100%,100%);right:-100%}10%{transform:translate(-100%);right:-100%}16%{transform:translate(-100%)}to{transform:translate(0);right:-100%}}@keyframes slide-in-down-right{0%{transform:translate(-100%,-100%);right:-100%}10%{transform:translate(-100%);right:-100%}16%{transform:translate(-100%)}to{transform:translate(0);right:-100%}}\n"], directives: [{ type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { type: i2.IntersectionObserverDirective, selector: "[intersectionObserver]", inputs: ["intersectionDebounce", "intersectionRootMargin", "intersectionRoot", "intersectionThreshold"], outputs: ["visibilityChange"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.2.0", ngImport: i0, type: NgxMarqueeComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ngx-marquee', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div class=\"ngx-marquee\" [ngClass]=\"{'ngx-marquee-pause-on-hover': pauseOnHover}\">\r\n    <span #tape>\r\n        <span class=\"ticker-control ticker-start\" \r\n            intersectionObserver\r\n            [intersectionRoot]=\"root\"\r\n            [intersectionRootMargin]=\"rootMargin\"\r\n            [intersectionThreshold]=\"threshold\"\r\n            [intersectionDebounce]=\"debounce\"\r\n            (visibilityChange)=\"onVisibilityChanged($event, 0)\">L</span>\r\n        <span class=\"tickers\">\r\n            <ng-content></ng-content>\r\n        </span>\r\n        <span class=\"ticker-control ticker-end\"\r\n            intersectionObserver\r\n            [intersectionRoot]=\"root\"\r\n            [intersectionRootMargin]=\"rootMargin\"\r\n            [intersectionThreshold]=\"threshold\"\r\n            [intersectionDebounce]=\"debounce\"\r\n            (visibilityChange)=\"onVisibilityChanged($event, 1)\">R</span>\r\n    </span>\r\n</div>", styles: [".ngx-marquee{overflow:hidden;text-align:left}.ngx-marquee.ngx-marquee-pause-on-hover:hover>span{animation-play-state:paused}.ngx-marquee>span{content:attr(data-marquee);display:inline-block;position:relative;white-space:nowrap;animation:linear infinite}.ngx-marquee>span{animation-duration:20s}.ngx-marquee>span{animation-direction:normal}.ngx-marquee span.ticker-control{display:inline-block;width:20px;text-align:center;color:transparent;background-color:transparent}.ngx-marquee.ngx-marquee-direction-left>span,.ngx-marquee.ngx-marquee-direction-normal>span{animation-direction:normal}@keyframes movement-smooth{0%{transform:translate(0);left:100%}to{transform:translate(-100%);left:0%}}@keyframes slide-in-up{0%{transform:translateY(100%);left:0%}10%{transform:translateY(0);left:0%}16%{transform:translate(0)}to{transform:translate(-100%);left:0%}}@keyframes slide-in-down{0%{transform:translateY(-100%);left:0%}10%{transform:translateY(0);left:0%}16%{transform:translate(0)}to{transform:translate(-100%);left:0%}}@keyframes slide-in-up-right{0%{transform:translate(-100%,100%);right:-100%}10%{transform:translate(-100%);right:-100%}16%{transform:translate(-100%)}to{transform:translate(0);right:-100%}}@keyframes slide-in-down-right{0%{transform:translate(-100%,-100%);right:-100%}10%{transform:translate(-100%);right:-100%}16%{transform:translate(-100%)}to{transform:translate(0);right:-100%}}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.Renderer2 }]; }, propDecorators: { direction: [{
                type: Input
            }], duration: [{
                type: Input
            }], pauseOnHover: [{
                type: Input
            }], animation: [{
                type: Input
            }], taskOnUpdateContent: [{
                type: Input
            }], taskOnUpdateDuration: [{
                type: Input
            }], pendingUpdates: [{
                type: Input
            }], pendingUpdatesChange: [{
                type: Output
            }], playStateChange: [{
                type: Output
            }], tape: [{
                type: ViewChild,
                args: ["tape"]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LW1hcnF1ZWUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LW1hcnF1ZWUvc3JjL2xpYi9uZ3gtbWFycXVlZS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtbWFycXVlZS9zcmMvbGliL25neC1tYXJxdWVlLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBaUIsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFhLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNySSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQzs7OztBQUU5RSxNQUFNLENBQU4sSUFBWSxZQUlYO0FBSkQsV0FBWSxZQUFZO0lBQ3RCLG1DQUFtQixDQUFBO0lBQ25CLGlDQUFpQixDQUFBO0lBQ2pCLG1DQUFtQixDQUFBO0FBQ3JCLENBQUMsRUFKVyxZQUFZLEtBQVosWUFBWSxRQUl2QjtBQUVELE1BQU0sQ0FBTixJQUFZLGdCQUlYO0FBSkQsV0FBWSxnQkFBZ0I7SUFDMUIsaUNBQWEsQ0FBQTtJQUNiLG1DQUFlLENBQUE7SUFDZiwyQ0FBdUIsQ0FBQTtBQUN6QixDQUFDLEVBSlcsZ0JBQWdCLEtBQWhCLGdCQUFnQixRQUkzQjtBQUVELE1BQU0sQ0FBTixJQUFZLGdCQUlYO0FBSkQsV0FBWSxnQkFBZ0I7SUFDMUIsdUNBQW1CLENBQUE7SUFDbkIsMkNBQXVCLENBQUE7SUFDdkIsK0NBQTJCLENBQUE7QUFDN0IsQ0FBQyxFQUpXLGdCQUFnQixLQUFoQixnQkFBZ0IsUUFJM0I7QUFRRCxNQUFNLE9BQU8sbUJBQW1CO0lBc0I5QixZQUFxQixTQUFvQjtRQUFwQixjQUFTLEdBQVQsU0FBUyxDQUFXO1FBSGpDLGdCQUFXLEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFL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O3NCQUFqQixLQUFLO2dCQUNHLG1CQUFtQjtzQkFBM0IsS0FBSztnQkFDRyxvQkFBb0I7c0JBQTVCLEtBQUs7Z0JBQ0csY0FBYztzQkFBdEIsS0FBSztnQkFDSSxvQkFBb0I7c0JBQTdCLE1BQU07Z0JBQ0csZUFBZTtzQkFBeEIsTUFBTTtnQkFDWSxJQUFJO3NCQUF0QixTQUFTO3VCQUFDLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIFJlbmRlcmVyMiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEludGVyc2VjdGlvblN0YXR1cyB9IGZyb20gJy4vb2JzZXJ2YWJsZXMvZnJvbS1pbnRlcnNlY3Rpb24tb2JzZXJ2ZXInO1xyXG5cclxuZXhwb3J0IGVudW0gTWFycXVlZVN0YXRlIHtcclxuICBSdW5uaW5nID0gXCJydW5uaW5nXCIsXHJcbiAgUGF1c2VkID0gXCJwYXVzZWRcIixcclxuICBTdG9wcGVkID0gXCJzdG9wcGVkXCJcclxufVxyXG5cclxuZXhwb3J0IGVudW0gTWFycXVlZURpcmVjdGlvbiB7XHJcbiAgTGVmdCA9ICdsZWZ0JyxcclxuICBSaWdodCA9ICdyaWdodCcsXHJcbiAgQWx0ZXJuYXRlID0gJ2FsdGVybmF0ZSdcclxufVxyXG5cclxuZXhwb3J0IGVudW0gTWFycXVlZUFuaW1hdGlvbiB7XHJcbiAgRGVmYXVsdCA9ICdkZWZhdWx0JyxcclxuICBTbGlkZUluVXAgPSAnc2xpZGVJblVwJyxcclxuICBTbGlkZUluRG93biA9ICdzbGlkZUluRG93bidcclxufVxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICduZ3gtbWFycXVlZScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL25neC1tYXJxdWVlLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9uZ3gtbWFycXVlZS5jb21wb25lbnQuc2NzcyddLFxyXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBOZ3hNYXJxdWVlQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XHJcblxyXG4gIEBJbnB1dCgpIGRpcmVjdGlvbjogTWFycXVlZURpcmVjdGlvbjtcclxuICBASW5wdXQoKSBkdXJhdGlvbjogc3RyaW5nO1xyXG4gIEBJbnB1dCgpIHBhdXNlT25Ib3ZlcjogYm9vbGVhbjtcclxuICBASW5wdXQoKSBhbmltYXRpb246IE1hcnF1ZWVBbmltYXRpb247XHJcbiAgQElucHV0KCkgdGFza09uVXBkYXRlQ29udGVudDogKCkgPT4gdm9pZDtcclxuICBASW5wdXQoKSB0YXNrT25VcGRhdGVEdXJhdGlvbjogKCkgPT4gc3RyaW5nOyAvLyBGb3JtYXRvIGVzcGVyYWRvIFwibnVtYmVyW3N8bXNdXCJcclxuICBASW5wdXQoKSBwZW5kaW5nVXBkYXRlczogYm9vbGVhbjtcclxuICBAT3V0cHV0KCkgcGVuZGluZ1VwZGF0ZXNDaGFuZ2U6IEV2ZW50RW1pdHRlcjxib29sZWFuPjtcclxuICBAT3V0cHV0KCkgcGxheVN0YXRlQ2hhbmdlOiBFdmVudEVtaXR0ZXI8TWFycXVlZVN0YXRlPjtcclxuICBAVmlld0NoaWxkKFwidGFwZVwiKSB0YXBlOiBIVE1MRWxlbWVudDtcclxuXHJcbiAgcmVhZG9ubHkgcm9vdDogSFRNTEVsZW1lbnQ7XHJcbiAgcmVhZG9ubHkgcm9vdE1hcmdpbjogc3RyaW5nO1xyXG4gIHJlYWRvbmx5IHRocmVzaG9sZDogbnVtYmVyIHwgbnVtYmVyW107XHJcbiAgcmVhZG9ubHkgZGVib3VuY2U6IG51bWJlcjtcclxuICBcclxuICBwcml2YXRlIF9lbGVtZW50TWFycXVlZTogYW55O1xyXG4gIHByaXZhdGUgX291dGVyRmxhZ3MgPSBbZmFsc2UsIGZhbHNlXTtcclxuICBwcml2YXRlIF9kYXRhUGxheVN0YXRlOiBNYXJxdWVlU3RhdGU7IFxyXG5cclxuICBjb25zdHJ1Y3RvciggcHJpdmF0ZSBfcmVuZGVyZXI6IFJlbmRlcmVyMiApXHJcbiAge1xyXG4gICAgdGhpcy5kZWJvdW5jZSA9IDA7XHJcbiAgICB0aGlzLnJvb3QgPSB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLnJvb3RNYXJnaW4gPSAnMHB4JztcclxuICAgIHRoaXMudGhyZXNob2xkID0gMDtcclxuICAgIHRoaXMuZHVyYXRpb24gPSAnMjBzJztcclxuICAgIHRoaXMuYW5pbWF0aW9uID0gTWFycXVlZUFuaW1hdGlvbi5EZWZhdWx0O1xyXG4gICAgdGhpcy5wYXVzZU9uSG92ZXIgPSBmYWxzZTtcclxuICAgIHRoaXMucGVuZGluZ1VwZGF0ZXMgPSBmYWxzZTtcclxuICAgIHRoaXMucGVuZGluZ1VwZGF0ZXNDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XHJcbiAgICB0aGlzLnBsYXlTdGF0ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8TWFycXVlZVN0YXRlPigpO1xyXG5cclxuICAgIGlmICh0eXBlb2YgdGhpcy50YXNrT25VcGRhdGVDb250ZW50ICE9PSAnZnVuY3Rpb24nKVxyXG4gICAge1xyXG4gICAgICB0aGlzLnRhc2tPblVwZGF0ZUNvbnRlbnQgPSAoKTogdm9pZCA9PiB7fTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodHlwZW9mIHRoaXMudGFza09uVXBkYXRlRHVyYXRpb24gIT09ICdmdW5jdGlvbicpXHJcbiAgICB7XHJcbiAgICAgIHRoaXMudGFza09uVXBkYXRlRHVyYXRpb24gPSAoKTogc3RyaW5nID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5kdXJhdGlvbjtcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkXHJcbiAge1xyXG4gICAgdGhpcy5fZWxlbWVudE1hcnF1ZWUgPSB0aGlzLl9yZW5kZXJlci5zZWxlY3RSb290RWxlbWVudCh0aGlzLnRhcGUsIHRydWUpLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICB0aGlzLl9yZXNldE1hcnF1ZWUoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBwbGF5UGF1c2UoKTogdm9pZFxyXG4gIHtcclxuICAgIGlmICggdGhpcy5fZGF0YVBsYXlTdGF0ZSA9PT0gbnVsbCB8fCB0aGlzLl9kYXRhUGxheVN0YXRlID09PSBNYXJxdWVlU3RhdGUuUnVubmluZyApXHJcbiAgICB7XHJcbiAgICAgIHRoaXMuX3BhdXNlRWxlbWVudCgpO1xyXG4gICAgfVxyXG4gICAgZWxzZVxyXG4gICAge1xyXG4gICAgICB0aGlzLl9wbGF5RWxlbWVudCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0b3AoKTogdm9pZFxyXG4gIHtcclxuICAgIHRoaXMuX3Jlc2V0QW5pbWF0aW9uKCk7XHJcbiAgICB0aGlzLl9zdG9wRWxlbWVudCgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHJlc3RhcnQoKTogdm9pZFxyXG4gIHtcclxuICAgIHRoaXMuX3Jlc2V0QW5pbWF0aW9uKCk7XHJcbiAgICB0aGlzLl9wbGF5RWxlbWVudCgpO1xyXG4gIH1cclxuIFxyXG4gIG9uVmlzaWJpbGl0eUNoYW5nZWQoc3RhdHVzOiBJbnRlcnNlY3Rpb25TdGF0dXMsIGNvbnRyb2w6IG51bWJlcik6IHZvaWRcclxuICB7XHJcbiAgICBpZiAoc3RhdHVzICE9PSBJbnRlcnNlY3Rpb25TdGF0dXMuUGVuZGluZylcclxuICAgIHtcclxuICAgICAgaWYgKHN0YXR1cyA9PT0gSW50ZXJzZWN0aW9uU3RhdHVzLlZpc2libGUpXHJcbiAgICAgIHtcclxuICAgICAgICB0aGlzLl9vdXRlckZsYWdzW2NvbnRyb2xdID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmIChzdGF0dXMgPT09IEludGVyc2VjdGlvblN0YXR1cy5Ob3RWaXNpYmxlKVxyXG4gICAgICB7XHJcbiAgICAgICAgdGhpcy5fb3V0ZXJGbGFnc1tjb250cm9sXSA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBpZiAodGhpcy5wZW5kaW5nVXBkYXRlcylcclxuICAgICAge1xyXG4gICAgICAgIGlmICggKHRoaXMuZGlyZWN0aW9uID09PSB1bmRlZmluZWQgfHwgdGhpcy5kaXJlY3Rpb24gPT09IE1hcnF1ZWVEaXJlY3Rpb24uTGVmdCkgJiYgKHRoaXMuX291dGVyRmxhZ3NbMF0gPT09IHRydWUgJiYgdGhpcy5fb3V0ZXJGbGFnc1sxXSA9PT0gZmFsc2UpIClcclxuICAgICAgICB7IFxyXG4gICAgICAgICAgdGhpcy5fZXhlY1Byb2NlZHVyZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICggdGhpcy5kaXJlY3Rpb24gPT09IE1hcnF1ZWVEaXJlY3Rpb24uUmlnaHQgJiYgKHRoaXMuX291dGVyRmxhZ3NbMF0gPT09IGZhbHNlICYmIHRoaXMuX291dGVyRmxhZ3NbMV0gPT09IHRydWUpIClcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0aGlzLl9leGVjUHJvY2VkdXJlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9ICBcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX2V4ZWNQcm9jZWR1cmUoKTogdm9pZFxyXG4gIHtcclxuICAgIHRoaXMudGFza09uVXBkYXRlQ29udGVudCgpO1xyXG4gICAgdGhpcy5fcmVzZXRNYXJxdWVlKCk7XHJcbiAgICB0aGlzLl9zZXRQZW5kaW5nVXBkYXRlcyhmYWxzZSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9zZXREYXRhUGxheVN0YXRlKCBzdGF0ZTogTWFycXVlZVN0YXRlICk6IHZvaWRcclxuICB7XHJcbiAgICB0aGlzLl9kYXRhUGxheVN0YXRlID0gc3RhdGU7XHJcbiAgICB0aGlzLnBsYXlTdGF0ZUNoYW5nZS5lbWl0KHRoaXMuX2RhdGFQbGF5U3RhdGUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfc2V0UGVuZGluZ1VwZGF0ZXMoIHN0YXRlOiBib29sZWFuICk6IHZvaWRcclxuICB7XHJcbiAgICB0aGlzLnBlbmRpbmdVcGRhdGVzID0gc3RhdGU7XHJcbiAgICB0aGlzLnBlbmRpbmdVcGRhdGVzQ2hhbmdlLmVtaXQodGhpcy5wZW5kaW5nVXBkYXRlcyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9yZXNldE1hcnF1ZWUoKTogdm9pZFxyXG4gIHtcclxuICAgIHRoaXMuc3RvcCgpO1xyXG4gICAgdGhpcy5fY2FsY3VsYXRlRHVyYXRpb24oKTtcclxuICAgIHRoaXMuX3BsYXlFbGVtZW50KCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9jYWxjdWxhdGVEdXJhdGlvbigpOiB2b2lkXHJcbiAge1xyXG4gICAgdGhpcy5kdXJhdGlvbiA9IHRoaXMudGFza09uVXBkYXRlRHVyYXRpb24oKTsgICAgICAgICAgXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9wbGF5RWxlbWVudCgpOiB2b2lkXHJcbiAge1xyXG4gICAgdGhpcy5fc2V0QW5pbWF0aW9uU3RhdGUoJ3J1bm5pbmcnLCB0cnVlKTtcclxuICAgIHRoaXMuX3NldERhdGFBdHRyU3RhdGUoJ3J1bm5pbmcnKTtcclxuICAgIHRoaXMuX3NldERhdGFQbGF5U3RhdGUoTWFycXVlZVN0YXRlLlJ1bm5pbmcpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfcGF1c2VFbGVtZW50KCk6IHZvaWRcclxuICB7XHJcbiAgICB0aGlzLl9zZXRBbmltYXRpb25TdGF0ZSgncGF1c2VkJyk7XHJcbiAgICB0aGlzLl9zZXREYXRhQXR0clN0YXRlKCdwYXVzZWQnKTtcclxuICAgIHRoaXMuX3NldERhdGFQbGF5U3RhdGUoTWFycXVlZVN0YXRlLlBhdXNlZCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9zdG9wRWxlbWVudCgpOiB2b2lkXHJcbiAge1xyXG4gICAgdGhpcy5fc2V0QW5pbWF0aW9uU3RhdGUoJ3BhdXNlZCcpO1xyXG4gICAgdGhpcy5fc2V0RGF0YUF0dHJTdGF0ZSgnc3RvcHBlZCcpO1xyXG4gICAgdGhpcy5fc2V0RGF0YVBsYXlTdGF0ZShNYXJxdWVlU3RhdGUuU3RvcHBlZCk7XHJcbiAgICB0aGlzLl9zZXRQZW5kaW5nVXBkYXRlcyhmYWxzZSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9zZXRBbmltYXRpb25TdGF0ZSggc3RhdGU6IHN0cmluZyA9ICcnLCBmaXg6IGJvb2xlYW4gPSBmYWxzZSApOiB2b2lkXHJcbiAge1xyXG4gICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUodGhpcy5fZWxlbWVudE1hcnF1ZWUsICdhbmltYXRpb24tcGxheS1zdGF0ZScsIHN0YXRlKTtcclxuICAgIFxyXG4gICAgaWYgKGZpeClcclxuICAgIHtcclxuICAgICAgdGhpcy5fZml4QW5pbWF0aW9uU3RhdGUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3Jlc2V0QW5pbWF0aW9uKCk6IHZvaWRcclxuICB7XHJcbiAgICB0aGlzLl9yZW5kZXJlci5zZXRTdHlsZSh0aGlzLl9lbGVtZW50TWFycXVlZSwgJ2FuaW1hdGlvbicsICdub25lJyk7XHJcbiAgICBsZXQgZml4ID0gdGhpcy5fZWxlbWVudE1hcnF1ZWUub2Zmc2V0V2lkdGg7IGZpeCA9IGZpeDtcclxuXHJcbiAgICB0aGlzLl9yZW5kZXJlci5zZXRTdHlsZSh0aGlzLl9lbGVtZW50TWFycXVlZSwgJ2FuaW1hdGlvbicsIGAke3RoaXMuZHVyYXRpb259IGxpbmVhciBpbmZpbml0ZWApO1xyXG4gICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUodGhpcy5fZWxlbWVudE1hcnF1ZWUsICctd2Via2l0LWFuaW1hdGlvbicsIGAke3RoaXMuZHVyYXRpb259IGxpbmVhciBpbmZpbml0ZWApO1xyXG5cclxuICAgIHN3aXRjaCAodGhpcy5kaXJlY3Rpb24pXHJcbiAgICB7XHJcbiAgICAgIGNhc2UgJ2FsdGVybmF0ZSc6IHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuX2VsZW1lbnRNYXJxdWVlLCAnYW5pbWF0aW9uLWRpcmVjdGlvbicsICdhbHRlcm5hdGUnKTsgYnJlYWs7XHJcbiAgICAgIGRlZmF1bHQ6IHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuX2VsZW1lbnRNYXJxdWVlLCAnYW5pbWF0aW9uLWRpcmVjdGlvbicsICdub3JtYWwnKTsgYnJlYWs7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuZGlyZWN0aW9uICE9PSBNYXJxdWVlRGlyZWN0aW9uLkFsdGVybmF0ZSlcclxuICAgIHtcclxuICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09PSB1bmRlZmluZWQgfHwgdGhpcy5kaXJlY3Rpb24gPT09IE1hcnF1ZWVEaXJlY3Rpb24uTGVmdClcclxuICAgICAge1xyXG4gICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbiA9PT0gTWFycXVlZUFuaW1hdGlvbi5TbGlkZUluVXApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUodGhpcy5fZWxlbWVudE1hcnF1ZWUsICdhbmltYXRpb24tbmFtZScsICdzbGlkZS1pbi11cCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLmFuaW1hdGlvbiA9PT0gTWFycXVlZUFuaW1hdGlvbi5TbGlkZUluRG93bilcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0aGlzLl9yZW5kZXJlci5zZXRTdHlsZSh0aGlzLl9lbGVtZW50TWFycXVlZSwgJ2FuaW1hdGlvbi1uYW1lJywgJ3NsaWRlLWluLWRvd24nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuX2VsZW1lbnRNYXJxdWVlLCAnYW5pbWF0aW9uLW5hbWUnLCAnbW92ZW1lbnQtc21vb3RoJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGVsc2UgaWYgKHRoaXMuZGlyZWN0aW9uID09PSBNYXJxdWVlRGlyZWN0aW9uLlJpZ2h0KVxyXG4gICAgICB7XHJcbiAgICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uID09PSBNYXJxdWVlQW5pbWF0aW9uLlNsaWRlSW5VcClcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0aGlzLl9yZW5kZXJlci5zZXRTdHlsZSh0aGlzLl9lbGVtZW50TWFycXVlZSwgJ2FuaW1hdGlvbi1uYW1lJywgJ3NsaWRlLWluLXVwLXJpZ2h0Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuYW5pbWF0aW9uID09PSBNYXJxdWVlQW5pbWF0aW9uLlNsaWRlSW5Eb3duKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuX2VsZW1lbnRNYXJxdWVlLCAnYW5pbWF0aW9uLW5hbWUnLCAnc2xpZGUtaW4tZG93bi1yaWdodCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUodGhpcy5fZWxlbWVudE1hcnF1ZWUsICdhbmltYXRpb24tZGlyZWN0aW9uJywgJ3JldmVyc2UnKTtcclxuICAgICAgICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuX2VsZW1lbnRNYXJxdWVlLCAnYW5pbWF0aW9uLW5hbWUnLCAnbW92ZW1lbnQtc21vb3RoJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlXHJcbiAgICB7XHJcbiAgICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuX2VsZW1lbnRNYXJxdWVlLCAnYW5pbWF0aW9uLW5hbWUnLCAnbW92ZW1lbnQtc21vb3RoJyk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfc2V0RGF0YUF0dHJTdGF0ZSggc3RhdGU6IHN0cmluZyA9ICcnICk6IHZvaWRcclxuICB7XHJcbiAgICB0aGlzLl9yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5fZWxlbWVudE1hcnF1ZWUsICdkYXRhLXBsYXktc3RhdGUnLCBzdGF0ZSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9maXhBbmltYXRpb25TdGF0ZSgpOiB2b2lkXHJcbiAge1xyXG4gICAgdGhpcy5fcmVuZGVyZXIucmVtb3ZlU3R5bGUodGhpcy5fZWxlbWVudE1hcnF1ZWUsICdhbmltYXRpb24tcGxheS1zdGF0ZScpO1xyXG4gIH1cclxuXHJcbn0iLCI8ZGl2IGNsYXNzPVwibmd4LW1hcnF1ZWVcIiBbbmdDbGFzc109XCJ7J25neC1tYXJxdWVlLXBhdXNlLW9uLWhvdmVyJzogcGF1c2VPbkhvdmVyfVwiPlxyXG4gICAgPHNwYW4gI3RhcGU+XHJcbiAgICAgICAgPHNwYW4gY2xhc3M9XCJ0aWNrZXItY29udHJvbCB0aWNrZXItc3RhcnRcIiBcclxuICAgICAgICAgICAgaW50ZXJzZWN0aW9uT2JzZXJ2ZXJcclxuICAgICAgICAgICAgW2ludGVyc2VjdGlvblJvb3RdPVwicm9vdFwiXHJcbiAgICAgICAgICAgIFtpbnRlcnNlY3Rpb25Sb290TWFyZ2luXT1cInJvb3RNYXJnaW5cIlxyXG4gICAgICAgICAgICBbaW50ZXJzZWN0aW9uVGhyZXNob2xkXT1cInRocmVzaG9sZFwiXHJcbiAgICAgICAgICAgIFtpbnRlcnNlY3Rpb25EZWJvdW5jZV09XCJkZWJvdW5jZVwiXHJcbiAgICAgICAgICAgICh2aXNpYmlsaXR5Q2hhbmdlKT1cIm9uVmlzaWJpbGl0eUNoYW5nZWQoJGV2ZW50LCAwKVwiPkw8L3NwYW4+XHJcbiAgICAgICAgPHNwYW4gY2xhc3M9XCJ0aWNrZXJzXCI+XHJcbiAgICAgICAgICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cclxuICAgICAgICA8L3NwYW4+XHJcbiAgICAgICAgPHNwYW4gY2xhc3M9XCJ0aWNrZXItY29udHJvbCB0aWNrZXItZW5kXCJcclxuICAgICAgICAgICAgaW50ZXJzZWN0aW9uT2JzZXJ2ZXJcclxuICAgICAgICAgICAgW2ludGVyc2VjdGlvblJvb3RdPVwicm9vdFwiXHJcbiAgICAgICAgICAgIFtpbnRlcnNlY3Rpb25Sb290TWFyZ2luXT1cInJvb3RNYXJnaW5cIlxyXG4gICAgICAgICAgICBbaW50ZXJzZWN0aW9uVGhyZXNob2xkXT1cInRocmVzaG9sZFwiXHJcbiAgICAgICAgICAgIFtpbnRlcnNlY3Rpb25EZWJvdW5jZV09XCJkZWJvdW5jZVwiXHJcbiAgICAgICAgICAgICh2aXNpYmlsaXR5Q2hhbmdlKT1cIm9uVmlzaWJpbGl0eUNoYW5nZWQoJGV2ZW50LCAxKVwiPlI8L3NwYW4+XHJcbiAgICA8L3NwYW4+XHJcbjwvZGl2PiJdfQ==